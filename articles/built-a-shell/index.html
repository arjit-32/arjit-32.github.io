<!DOCTYPE html><html lang="en-GB" class="scroll-smooth"> <head><meta charset="utf-8"><meta content="width=device-width, initial-scale=1.0, shrink-to-fit=no" name="viewport"><meta content="IE=edge" http-equiv="X-UA-Compatible"><title>Building your own Shell ‚Ä¢ Arjit Sharma Portfolio</title><script async src="https://www.googletagmanager.com/gtag/js?id=G-HS0T8J3NHK"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-HS0T8J3NHK');
</script><!-- <link href="favicon/favicon.ico" rel="icon" sizes="any" />
<link href="favicon/icon.svg" rel="icon" type="image/svg+xml" />
<link href="/apple-touch-icon.png" rel="apple-touch-icon" />
<link href="/manifest.webmanifest" rel="manifest" /> --><link rel="apple-touch-icon" sizes="180x180" href="/favicon/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/favicon/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/favicon/favicon-16x16.png"><link rel="manifest" href="/favicon/site.webmanifest"><!-- <link rel='preload' href='/fonts/Satoshi-Variable.ttf' as='font' type='font/ttf' crossorigin />
<link
	rel='preload'
	href='/fonts/Satoshi-VariableItalic.ttf'
	as='font'
	type='font/ttf'
	crossorigin
/>
<link rel='preload' href='/fonts/ClashDisplay-Variable.ttf' as='font' type='font/ttf' crossorigin /> --><link rel="canonical" href="https://arjit-32.github.io/articles/built-a-shell/"><meta content="Building your own Shell ‚Ä¢ Arjit Sharma Portfolio" name="title"><meta content="Learn about operating system concept by building your own shell" name="description"><meta content="SRLEOM" name="author"><meta content="" name="theme-color"><meta content="article" property="og:type"><meta content="Building your own Shell" property="og:title"><meta content="Learn about operating system concept by building your own shell" property="og:description"><meta content="https://arjit-32.github.io/articles/built-a-shell/" property="og:url"><meta content="Arjit Sharma Portfolio" property="og:site_name"><meta content="en_GB" property="og:locale"><meta content="https://arjit-32.github.io/social-card.png" property="og:image"><meta content="1200" property="og:image:width"><meta content="630" property="og:image:height"><meta content="SRLEOM" property="article:author"><meta content="2025-04-09T00:00:00.000Z" property="article:published_time"><meta content="summary_large_image" property="twitter:card"><meta content="https://arjit-32.github.io/articles/built-a-shell/" property="twitter:url"><meta content="Building your own Shell" property="twitter:title"><meta content="Learn about operating system concept by building your own shell" property="twitter:description"><meta content="https://arjit-32.github.io/social-card.png" property="twitter:image"><link href="/sitemap-index.xml" rel="sitemap"><link href="/rss.xml" rel="alternate" title="Arjit Sharma Portfolio" type="application/rss+xml"><meta content="Astro v4.9.2" name="generator"><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-K51JGWEES3"></script><link rel="stylesheet" href="/_astro/_slug_.BhQYTNcJ.css"><script type="module">window.dataLayer=window.dataLayer||[];function e(){dataLayer.push(arguments)}e("js",new Date);e("config","G-K51JGWEES3");function n(){return localStorage.getItem("theme")}const a=document.getElementById("toggleDarkMode");a?.addEventListener("click",()=>{const t=new CustomEvent("theme-change",{detail:{theme:n()==="light"?"dark":"light"}});document.dispatchEvent(t)});
</script>
<script type="module" src="/_astro/page.DFwqf4PB.js"></script></head> <body class="bg-background text-foreground font-sans antialiased"> <script>
	const lightModePref = window.matchMedia('(prefers-color-scheme: light)')

	// Get user preference from local storage or from browser preference
	function getUserPref() {
		const storedTheme = localStorage.getItem('theme') ?? undefined
		return storedTheme || (lightModePref.matches ? 'light' : 'dark')
	}

	function setTheme(newTheme) {
		if (newTheme !== 'light' && newTheme !== 'dark') {
			return console.log(`Invalid theme value '${newTheme}' received. Expected 'light' or 'dark'.`)
		}

		localStorage.setItem('theme', newTheme)

		const root = document.documentElement

		// if current dark theme and new theme is dark, return
		if (newTheme === 'dark' && root.classList.contains('dark')) {
			return
		} else if (newTheme === 'light' && !root.classList.contains('dark')) {
			return
		}

		root.classList.toggle('dark')
	}

	// Initial Setup
	setTheme(getUserPref())

	// View Transitions hook to restore theme
	document.addEventListener('astro:after-swap', () => setTheme(getUserPref()))

	// Listen for theme-change custom event
	document.addEventListener('theme-change', (e) => {
		setTheme(e.detail.theme)
	})

	// Listen for prefers-color-scheme change
	lightModePref.addEventListener('change', (e) => setTheme(e.matches ? 'light' : 'dark'))
</script> <div class="flex min-h-screen flex-col px-4 sm:px-6 md:px-8"> <header class="w-full max-w-6xl mx-auto py-6 px-4 sm:px-6 md:px-8"> <nav class="flex items-center justify-between"> <a class="text-xl font-bold tracking-tight hover:text-primary transition-colors" href="/">
Arjit Sharma
</a> <div class="flex items-center gap-x-6"> <a href="/projects/" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors"> Projects </a><a href="/articles/" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors"> Articles </a><a href="/resume/" class="text-sm font-medium text-muted-foreground hover:text-primary transition-colors"> Resume </a> <button id="toggleDarkMode" class="group p-2 transition-colors hover:text-primary" aria-label="Toggle Dark Mode"> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="hidden dark:block fill-current"> <path d="M12 3a9 9 0 1 0 9 9c0-.46-.04-.92-.1-1.36a5.389 5.389 0 0 1-4.4 2.26 5.403 5.403 0 0 1-3.14-9.8c-.44-.06-.9-.1-1.36-.1z"></path> </svg> <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" class="block dark:hidden fill-current"> <path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37a.996.996 0 0 0-1.41 0 .996.996 0 0 0 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96a.996.996 0 0 0 0-1.41.996.996 0 0 0-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36a.996.996 0 0 0 0 1.41.996.996 0 0 0 1.41 0l1.06-1.06c.39-.39.39-1.03 0-1.41s-1.03-.39-1.41 0l-1.06 1.06z"></path> </svg> </button> </div> </nav> </header>  <main class="flex-1 w-full max-w-6xl mx-auto py-10">  <div class="mb-8 border-b border-border/40 pb-8"> <a href="/articles/" class="text-sm text-muted-foreground hover:text-primary transition-colors mb-4 inline-block">&larr; Back to articles</a> <h1 class="text-3xl font-bold tracking-tight mb-2">Building your own Shell</h1> <div class="flex items-center gap-4 text-sm text-muted-foreground"> <time datetime="2025-04-09T00:00:00.000Z"> 9 April 2025 </time> <span>&bull;</span> <div class="flex gap-2"> <span>#Project</span> </div> </div> </div> <article class="prose dark:prose-invert prose-stone max-w-none"> <p>I always wanted to get my hands dirty with a operating systems project, so I <em>finally</em> did and set out to build my own shell. It was perfect choice: not too complex to scare soy-dev like me, yet rich enough to explore funamental concept of running a program via command line.</p>
<p>If you want to dive straight into the code, check out the full source here:¬†<a href="https://github.com/arjit-32/VOSHI" rel="nofollow noopener noreferrer" target="_blank"><strong>GitHub Repo üî•</strong></a></p>
<blockquote>
<p><em><strong>Disclaimer: I am not a subject expert in systems programming. I am just sharing my findings.</strong></em></p>
</blockquote>
<h2 id="demo-video">Demo Video</h2>
<iframe src="https://www.youtube.com/embed/lZmNmvFkTSk?si=1itJcOjv_k6_tr5U" width="100%" height="500px" class="w-full h-[500px] border-none" title="Voshi dashboard">

What is a Shell</iframe>
<p>A shell is a command-line interface, i.e., instead of you clickity clackity on that mouse just enter a command and something happens on your computer, can be changing a folder or listing files and much more. Originating in the 1970s with the Unix shell, but now has many modern alternatives like Zsh and Fish, enhancing usability and scripting capabilities.</p>
<br>
<h3 id="the-broad-picture">The Broad Picture</h3>
<img src="https://res.cloudinary.com/dwa6rcttw/image/upload/v1748250979/Screenshot_2025-05-26_144533_t81wjg.png" alt="broad-picture-of-shell">
<p>1Ô∏è‚É£ Start the shell ‚Üí It shows a prompt and waits for user input.</p>
<p>2Ô∏è‚É£ User enters a command ‚Üí The shell reads and tokenizes the input.</p>
<p>3Ô∏è‚É£  create a child process (<code>fork()</code>) ‚Üí The child runs the command using <code>execvp()</code> .</p>
<p>4Ô∏è‚É£ Parent process waits (<code>wait()</code>) ‚Üí Ensures the command finishes before taking new input.</p>
<p>5Ô∏è‚É£ Repeat until user exits ‚Üí The loop continues, keeping the shell running.</p>
<p><em>NOTE -  <strong>execvp()</strong> runs programs by searching for their executable file in the directories listed in the <strong>$PATH</strong> environment variable ( this includes system binaries and any custom programs installed in user-defined locations )</em></p>
<hr>
<h2 id="lets-start-with-the-loop">Lets Start with the Loop</h2>
<p>The fundamental part of any shell is an <strong>infinite loop</strong> that keeps the shell running until the user decides to exit.</p>
<div class="expressive-code"><link rel="stylesheet" href="/_astro/ec.v6sg1.css"><script type="module" src="/_astro/ec.dy9ns.js"></script><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">void</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">do</span><span style="--0:#F8F8F2;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#96A1C2;--1:#616972">// Take Input</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">} </span><span style="--0:#FF79C6;--1:#BF3441">while</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">!</span><span style="--0:#F8F8F2;--1:#24292E">quit);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">main</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void loop() {    int quit = 0;    do {        // Take Input    } while (!quit);}int main() {    loop();    return 0;}"><div></div></button></div></figure></div>
<hr>
<h2 id="taking-input">Taking Input</h2>
<p>Now that we have an infinite loop running, the next step is to take user input so the shell can process commands.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">void</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#F8F8F2;--1:#AE4B07">input</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">];</span><span style="--0:#96A1C2;--1:#616972"> // Buffer to store user input</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">do</span><span style="--0:#F8F8F2;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">printf</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span><span style="--0:#96A1C2;--1:#616972"> // Display the prompt</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">fgets</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(input), stdin);</span><span style="--0:#96A1C2;--1:#616972"> // Read user input</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#96A1C2;--1:#616972">// Trim the newline character</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#AE4B07">input</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#50FA7B;--1:#6F42C1">strcspn</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\n</span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#F8F8F2;--1:#24292E">)] </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#FF79C6;--1:#005CC5">\0</span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#96A1C2;--1:#616972">// Check for exit command</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#50FA7B;--1:#6F42C1">strcmp</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">exit</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">==</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">            </span></span><span style="--0:#F8F8F2;--1:#24292E">quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">        </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">} </span><span style="--0:#FF79C6;--1:#BF3441">while</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">!</span><span style="--0:#F8F8F2;--1:#24292E">quit);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">main</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void loop() {    char input[100]; // Buffer to store user input    int quit = 0;    do {        printf(&#x22;voshi> &#x22;); // Display the prompt        fgets(input, sizeof(input), stdin); // Read user input        // Trim the newline character        input[strcspn(input, &#x22;\n&#x22;)] = &#x27;\0&#x27;;        // Check for exit command        if (strcmp(input, &#x22;exit&#x22;) == 0) {            quit = 1;        }    } while (!quit);}int main() {    loop();    return 0;}"><div></div></button></div></figure></div>
<hr>
<h2 id="execute-user-command">Execute User Command</h2>
<p>Now that we have an <strong>infinite loop</strong> and can <strong>take input</strong>, the next step is to <strong>execute user commands</strong></p>
<p>To run commands like <em>ls, echo, mkdir (in case of linux),</em>  we need to:</p>
<ul>
<li>Create a Child Process using <em><strong>fork()</strong></em></li>
<li>Replace it with the command <em><strong>execvp()</strong></em></li>
<li>Make the parent wait until the command finished <em><strong>wait()</strong></em></li>
</ul>
<img src="https://res.cloudinary.com/dwa6rcttw/image/upload/v1748250978/Screenshot_2025-05-26_142252_izq5r8.png" alt="parent-child-process">
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">stdio.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">stdlib.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">unistd.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">string.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">sys/wait.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">void</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#F8F8F2;--1:#AE4B07">input</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">];</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">do</span><span style="--0:#F8F8F2;--1:#24292E"> {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">printf</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">fgets</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(input), stdin);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#AE4B07">input</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#50FA7B;--1:#6F42C1">strcspn</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\n</span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#F8F8F2;--1:#24292E">)] </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#FF79C6;--1:#005CC5">\0</span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#F8F8F2;--1:#24292E">;</span><span style="--0:#96A1C2;--1:#616972"> // Remove newline</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#50FA7B;--1:#6F42C1">strcmp</span><span style="--0:#F8F8F2;--1:#24292E">(input, </span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">exit</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">) </span><span style="--0:#FF79C6;--1:#BF3441">==</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">            </span></span><span style="--0:#F8F8F2;--1:#24292E">quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#FF79C6;--1:#BF3441">continue</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">        </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#96A1C2;--1:#616972">// Fork a process to run the command</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#BF3441">pid_t</span><span style="--0:#F8F8F2;--1:#24292E"> pid </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">fork</span><span style="--0:#F8F8F2;--1:#24292E">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (pid </span><span style="--0:#FF79C6;--1:#BF3441">==</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">) {</span><span style="--0:#96A1C2;--1:#616972"> // Child process</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">args</span><span style="--0:#FF79C6;--1:#BF3441">[]</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> {input, </span><span style="--0:#BD93F9;--1:#005CC5">NULL</span><span style="--0:#F8F8F2;--1:#24292E">};</span><span style="--0:#96A1C2;--1:#616972"> // Prepare command</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#50FA7B;--1:#6F42C1">execvp</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#F8F8F2;--1:#AE4B07">args</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">], args);</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#50FA7B;--1:#6F42C1">perror</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">exec failed</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span><span style="--0:#96A1C2;--1:#616972"> // If command fails</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#50FA7B;--1:#6F42C1">exit</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">1</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">        </span></span><span style="--0:#F8F8F2;--1:#24292E">} </span><span style="--0:#FF79C6;--1:#BF3441">else</span><span style="--0:#F8F8F2;--1:#24292E"> {</span><span style="--0:#96A1C2;--1:#616972"> // Parent process</span></div></div><div class="ec-line"><div class="code"><span class="indent">            </span><span style="--0:#50FA7B;--1:#6F42C1">wait</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#BD93F9;--1:#005CC5">NULL</span><span style="--0:#F8F8F2;--1:#24292E">);</span><span style="--0:#96A1C2;--1:#616972"> // Wait for child to finish</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">        </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">} </span><span style="--0:#FF79C6;--1:#BF3441">while</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">!</span><span style="--0:#F8F8F2;--1:#24292E">quit);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">main</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">();</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <stdio.h>#include <stdlib.h>#include <unistd.h>#include <string.h>#include <sys/wait.h>void loop() {    char input[100];    int quit = 0;    do {        printf(&#x22;voshi> &#x22;);        fgets(input, sizeof(input), stdin);        input[strcspn(input, &#x22;\n&#x22;)] = &#x27;\0&#x27;; // Remove newline        if (strcmp(input, &#x22;exit&#x22;) == 0) {            quit = 1;            continue;        }        // Fork a process to run the command        pid_t pid = fork();        if (pid == 0) { // Child process            char *args[] = {input, NULL}; // Prepare command            execvp(args[0], args);            perror(&#x22;exec failed&#x22;); // If command fails            exit(1);        } else { // Parent process            wait(NULL); // Wait for child to finish        }    } while (!quit);}int main() {    loop();    return 0;}"><div></div></button></div></figure></div>
<hr>
<h2 id="advanced-features">Advanced Features</h2>
<h3 id="history">History</h3>
<p>A terminal can operate in <strong>two modes</strong> when accepting input from the user:</p>
<ol>
<li>Canonical Mode (Line-Buffered Mode): The terminal buffers input until the user presses Enter (\n), then sends the entire line to the program.</li>
<li>Raw Mode (Character-Buffered Mode): <strong>Every keystroke</strong> is sent immediately to the program without waiting for enter.</li>
</ol>
<p>We can also use <strong>GNU Readline</strong>, which operates in canonical mode but also gives us command history using arrow keys, which otherwise we would have to do it ourselves by enabling raw mode.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">readline/readline.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">#include</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">&#x3C;</span><span style="--0:#F1FA8C">readline/history.h</span><span style="--0:#E9F284">></span></span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">void</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">loop</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">input;</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> quit </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">0</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">using_history</span><span style="--0:#F8F8F2;--1:#24292E">();</span><span style="--0:#96A1C2;--1:#616972"> // Enable history tracking</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">do</span><span style="--0:#F8F8F2;--1:#24292E">{</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">       </span></span><span style="--0:#F8F8F2;--1:#24292E">input </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">readline</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#50FA7B;--1:#6F42C1">add_history</span><span style="--0:#F8F8F2;--1:#24292E">(input);</span><span style="--0:#96A1C2;--1:#616972"> // Store command in history</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">       </span><span style="--0:#96A1C2;--1:#616972">// Rest of the code</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="#include <readline/readline.h>#include <readline/history.h>void loop() {    char *input;    int quit = 0;    using_history(); // Enable history tracking    do{       input = readline(&#x22;voshi> &#x22;);       add_history(input); // Store command in history       // Rest of the code"><div></div></button></div></figure></div>
<h3 id="custom-prompts">Custom Prompts</h3>
<p>We can even show current directory we are present in like most shells do.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#50FA7B;--1:#6F42C1">get_prompt</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">static</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#F8F8F2;--1:#AE4B07">prompt</span><span style="--0:#F8F8F2;--1:#24292E">[PATH_MAX </span><span style="--0:#FF79C6;--1:#BF3441">+</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">50</span><span style="--0:#F8F8F2;--1:#24292E">];</span><span style="--0:#96A1C2;--1:#616972"> // Store formatted prompt</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#F8F8F2;--1:#AE4B07">cwd</span><span style="--0:#F8F8F2;--1:#24292E">[PATH_MAX];</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#50FA7B;--1:#6F42C1">getcwd</span><span style="--0:#F8F8F2;--1:#24292E">(cwd, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(cwd)) </span><span style="--0:#FF79C6;--1:#BF3441">==</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">NULL</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">perror</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">getcwd failed</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">snprintf</span><span style="--0:#F8F8F2;--1:#24292E">(prompt, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(prompt), </span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\033</span><span style="--0:#F1FA8C;--1:#032F62">[1;32m</span><span style="--1:#005CC5"><span style="--0:#BD93F9">%s</span><span style="--0:#FF79C6">\033</span></span><span style="--1:#032F62"><span style="--0:#F1FA8C">[0m voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">, cwd);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> prompt;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="char *get_prompt() {    static char prompt[PATH_MAX + 50]; // Store formatted prompt    char cwd[PATH_MAX];    if (getcwd(cwd, sizeof(cwd)) == NULL) {        perror(&#x22;getcwd failed&#x22;);        return &#x22;voshi> &#x22;;    }    snprintf(prompt, sizeof(prompt), &#x22;\033[1;32m%s\033[0m voshi> &#x22;, cwd);    return prompt;}"><div></div></button></div></figure></div>
<p>Now just have to modify the input taking to use</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">input </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">readline</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#50FA7B;--1:#6F42C1">get_prompt</span><span style="--0:#F8F8F2;--1:#24292E">());</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="input = readline(get_prompt());"><div></div></button></div></figure></div>
<h3 id="git-branches">Git branches</h3>
<p>When working on projects, developers often switch branches. Displaying the <strong>active Git branch in the prompt</strong> would makes it easier to track the current context without running <em>git branch</em> manually.</p>
<p>Use <code>git rev-parse --abbrev-ref HEAD 2>/dev/null</code> to get current branch and <code>popen()</code> to capture the output.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#50FA7B;--1:#6F42C1">get_git_branch</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">static</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#F8F8F2;--1:#AE4B07">branch</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#BD93F9;--1:#005CC5">100</span><span style="--0:#F8F8F2;--1:#24292E">];</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">FILE </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">fp </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">popen</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">git rev-parse --abbrev-ref HEAD 2>/dev/null</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">, </span><span style="--1:#032F62"><span style="--0:#E9F284">"</span><span style="--0:#F1FA8C">r</span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#FF79C6;--1:#BF3441">!</span><span style="--0:#F8F8F2;--1:#24292E">fp) </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">""</span><span style="--0:#F8F8F2;--1:#24292E">;</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (</span><span style="--0:#50FA7B;--1:#6F42C1">fgets</span><span style="--0:#F8F8F2;--1:#24292E">(branch, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(branch), fp) </span><span style="--0:#FF79C6;--1:#BF3441">!=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#BD93F9;--1:#005CC5">NULL</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2">        </span></span><span style="--0:#F8F8F2;--1:#AE4B07">branch</span><span style="--0:#F8F8F2;--1:#24292E">[</span><span style="--0:#50FA7B;--1:#6F42C1">strcspn</span><span style="--0:#F8F8F2;--1:#24292E">(branch, </span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\n</span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#F8F8F2;--1:#24292E">)] </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#FF79C6;--1:#005CC5">\0</span><span style="--0:#E9F284;--1:#032F62">'</span><span style="--0:#F8F8F2;--1:#24292E">;</span><span style="--0:#96A1C2;--1:#616972"> // Remove newline</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">pclose</span><span style="--0:#F8F8F2;--1:#24292E">(fp);</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">return</span><span style="--0:#F8F8F2;--1:#24292E"> branch;</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="char *get_git_branch() {    static char branch[100];    FILE *fp = popen(&#x22;git rev-parse --abbrev-ref HEAD 2>/dev/null&#x22;, &#x22;r&#x22;);    if (!fp) return &#x22;&#x22;;    if (fgets(branch, sizeof(branch), fp) != NULL) {        branch[strcspn(branch, &#x22;\n&#x22;)] = &#x27;\0&#x27;; // Remove newline    }    pclose(fp);    return branch;}"><div></div></button></div></figure></div>
<p>Now while creating a prompt you can add the line to put git branch</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#50FA7B;--1:#6F42C1">get_prompt</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent"> </span><span style="--0:#96A1C2;--1:#616972">// ... Prev Code</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">char</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FF79C6;--1:#BF3441">*</span><span style="--0:#F8F8F2;--1:#24292E">git_branch </span><span style="--0:#FF79C6;--1:#BF3441">=</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">get_git_branch</span><span style="--0:#F8F8F2;--1:#24292E">();</span></div></div><div class="ec-line"><div class="code"><span style="--0:#50FA7B;--1:#6F42C1">snprintf</span><span style="--0:#F8F8F2;--1:#24292E">(prompt, </span><span style="--0:#FF79C6;--1:#BF3441">sizeof</span><span style="--0:#F8F8F2;--1:#24292E">(prompt), </span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\033</span><span style="--0:#F1FA8C;--1:#032F62">[1;32m</span><span style="--0:#BD93F9;--1:#005CC5">%s</span><span style="--0:#F1FA8C;--1:#032F62"> </span><span style="--0:#FF79C6;--1:#005CC5">\033</span><span style="--0:#F1FA8C;--1:#032F62">[1;34m(</span><span style="--0:#BD93F9;--1:#005CC5">%s</span><span style="--0:#F1FA8C;--1:#032F62">)</span><span style="--0:#FF79C6;--1:#005CC5">\033</span><span style="--1:#032F62"><span style="--0:#F1FA8C">[0m voshi> </span><span style="--0:#E9F284">"</span></span><span style="--0:#F8F8F2;--1:#24292E">, cwd, git_branch);</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="char *get_prompt() { // ... Prev Codechar *git_branch = get_git_branch();snprintf(prompt, sizeof(prompt), &#x22;\033[1;32m%s \033[1;34m(%s)\033[0m voshi> &#x22;, cwd, git_branch);}"><div></div></button></div></figure></div>
<h3 id="sigint-handling-ctrlc">SIGINT Handling (Ctrl+C)</h3>
<p>When using a shell, pressing Ctrl+C sends the SIGINT (Signal Interrupt) to terminate a running process. To ensure graceful handling, instead of abruptly killing the shell, we can override the default behavior using a custom signal handler.</p>
<div class="expressive-code"><figure class="frame"><figcaption class="header"></figcaption><pre tabindex="0"><code><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">void</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">sigint_handler</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#FFB86C;--0fs:italic;--1:#AE4B07">signo</span><span style="--0:#F8F8F2;--1:#24292E">) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#FF79C6;--1:#BF3441">if</span><span style="--0:#F8F8F2;--1:#24292E"> (signo </span><span style="--0:#FF79C6;--1:#BF3441">==</span><span style="--0:#F8F8F2;--1:#24292E"> SIGINT) {</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">printf</span><span style="--0:#F8F8F2;--1:#24292E">(</span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#FF79C6;--1:#005CC5">\n\n\033</span><span style="--0:#F1FA8C;--1:#032F62">[1;31mUse </span><span style="--0:#FF79C6;--1:#005CC5">\"</span><span style="--0:#F1FA8C;--1:#032F62">exit</span><span style="--0:#FF79C6;--1:#005CC5">\"</span><span style="--0:#F1FA8C;--1:#032F62"> to quit voshi.</span><span style="--0:#FF79C6;--1:#005CC5">\033</span><span style="--0:#F1FA8C;--1:#032F62">[0m</span><span style="--0:#FF79C6;--1:#005CC5">\n</span><span style="--0:#E9F284;--1:#032F62">"</span><span style="--0:#F8F8F2;--1:#24292E">);</span></div></div><div class="ec-line"><div class="code"><span class="indent">        </span><span style="--0:#50FA7B;--1:#6F42C1">fflush</span><span style="--0:#F8F8F2;--1:#24292E">(stdout);</span></div></div><div class="ec-line"><div class="code"><span class="indent"><span style="--0:#F8F8F2;--1:#24292E">    </span></span><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code">
</div></div><div class="ec-line"><div class="code"><span style="--0:#FF79C6;--1:#BF3441">int</span><span style="--0:#F8F8F2;--1:#24292E"> </span><span style="--0:#50FA7B;--1:#6F42C1">main</span><span style="--0:#F8F8F2;--1:#24292E">() {</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#50FA7B;--1:#6F42C1">signal</span><span style="--0:#F8F8F2;--1:#24292E">(SIGINT, sigint_handler);</span><span style="--0:#96A1C2;--1:#616972"> // Register custom SIGINT handler</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#96A1C2;--1:#616972">// Rest of the code</span></div></div><div class="ec-line"><div class="code"><span class="indent">    </span><span style="--0:#96A1C2;--1:#616972">// ...</span></div></div><div class="ec-line"><div class="code"><span style="--0:#F8F8F2;--1:#24292E">}</span></div></div></code></pre><div class="copy"><button title="Copy to clipboard" data-copied="Copied!" data-code="void sigint_handler(int signo) {    if (signo == SIGINT) {        printf(&#x22;\n\n\033[1;31mUse \&#x22;exit\&#x22; to quit voshi.\033[0m\n&#x22;);        fflush(stdout);    }}int main() {    signal(SIGINT, sigint_handler); // Register custom SIGINT handler    // Rest of the code    // ...}"><div></div></button></div></figure></div>
<hr>
<h2 id="conclusion">Conclusion</h2>
<p>Creating a shell is a fantastic way to understand <strong>operating system internals</strong>, process management, and input handling.</p>
<p>Furthermore you can add tab completions, background process, job control and many more features to your custom shell, as for my case I added a dashboard, a place that gives me weather, hackernews &#x26; techcrunch news. You can download my shell from the <a href="https://arjit-32.github.io/VOSHI/" rel="nofollow noopener noreferrer" target="_blank">website</a> or read the codebase from <a href="https://github.com/arjit-32/VOSHI/blob/main/src/main.c" rel="nofollow noopener noreferrer" target="_blank">github</a> repo.</p>
<hr>
<p>Thanks to <a href="https://igupta.in/" rel="nofollow noopener noreferrer" target="_blank">Indradhanush Gupta</a> for making this a possibility !</p> </article>  </main> <footer class="mt-20 w-full max-w-3xl mx-auto pb-10 border-t border-border/40 pt-6"> <div class="flex flex-col sm:flex-row items-center justify-between gap-4 text-sm text-muted-foreground"> <p>&copy; 2026 Arjit Sharma. All rights reserved.</p> <div class="flex items-center gap-x-6"> <a href="https://github.com/arjit-32" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">
GitHub
</a> <a href="https://www.linkedin.com/in/arjit32/" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">
LinkedIn
</a> <a href="https://x.com/arjit32" target="_blank" rel="noopener noreferrer" class="hover:text-foreground transition-colors">
Twitter
</a> </div> </div> </footer> </div> </body></html>